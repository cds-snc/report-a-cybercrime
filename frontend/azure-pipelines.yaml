#frontend pipeline

trigger:
  branches:
    include:
      - master
  paths:
    include:
      - frontend
    exclude:
      - api/*
      - frontend/manifests/*

pool:
  vmImage: 'ubuntu-16.04'

steps:
  - task: Npm@1
    inputs:
      command: 'install'
      workingDir: 'frontend'

  - script: |
      cd frontend
      npm run compile
      npm run coverage
      npm run lint
      npm run check-translations
    displayName: 'Run npm scripts'

  - task: Docker@2
    inputs:
      containerRegistry: 'scACR-F2'
      repository: 'frontend'
      command: 'build'
      Dockerfile: 'frontend/Dockerfile'
      tags: |
        $(Build.SourceBranchName)
        $(Build.SourceBranchName)$(_DASH)$(Build.SourceVersion)
        latest
      arguments: --build-arg RAZZLE_GOOGLE_ANALYTICS_ID=$(_RAZZLE_GOOGLE_ANALYTICS_ID)

  - task: Docker@2
    inputs:
      containerRegistry: 'scACR'
      repository: 'frontend'
      command: 'push'
      tags: |
        $(Build.SourceBranchName)
        $(Build.SourceBranchName)$(_DASH)$(Build.SourceVersion)
        latest
